# Diary 日記帳アプリ<!-- omit in toc -->
![Diary](https://github.com/user-attachments/assets/0d779b3c-b6f0-4737-aa45-9423b815b7cc)

## 目次<!-- omit in toc -->
- [概要](#概要)
- [公開URL](#公開url)
- [目的](#目的)
- [こだわったポイント](#こだわったポイント)
- [今後の展望](#今後の展望)
- [使用技術](#使用技術)
- [使用フォント](#使用フォント)
- [デザインカンプ](#デザインカンプ)
- [テーブル定義書](#テーブル定義書)
- [機能テスト](#機能テスト)
- [各画面・機能説明](#各画面機能説明)
  - [ログイン画面](#ログイン画面)
    - [ユーザー認証](#ユーザー認証)
    - [お試しログイン機能](#お試しログイン機能)
    - [入力値バリデーション](#入力値バリデーション)
    - [通知メッセージ表示](#通知メッセージ表示)
    - [画面遷移](#画面遷移)
  - [ユーザー登録画面](#ユーザー登録画面)
    - [新規ユーザー登録](#新規ユーザー登録)
    - [入力値バリデーション](#入力値バリデーション-1)
    - [画面遷移](#画面遷移-1)
  - [Home画面](#home画面)
    - [ユーザー情報カード](#ユーザー情報カード)
    - [お知らせ機能](#お知らせ機能)
    - [最近の日記リスト](#最近の日記リスト)
    - [画面遷移](#画面遷移-2)
  - [日記一覧画面](#日記一覧画面)
    - [検索設定](#検索設定)
    - [日記一覧とページネーション](#日記一覧とページネーション)
    - [日記の操作（編集・削除）](#日記の操作編集削除)
  - [日記作成画面](#日記作成画面)
    - [新規作成・更新モード共通の機能](#新規作成更新モード共通の機能)
    - [新規作成モード](#新規作成モード)
    - [更新モード](#更新モード)
  - [404 Not Found画面](#404-not-found画面)
  - [ヘッダー](#ヘッダー)
    - [レスポンシブデザイン](#レスポンシブデザイン)
    - [ハンバーガーボタン (SP時)](#ハンバーガーボタン-sp時)
    - [動的なリンク切り替え](#動的なリンク切り替え)
    - [ユーザー名表示](#ユーザー名表示)
    - [リンク無効化](#リンク無効化)
  - [フッター](#フッター)
    - [動的なリンク切り替え](#動的なリンク切り替え-1)
    - [外部リンク](#外部リンク)
    - [リンク無効化](#リンク無効化-1)
  - [フローティング作成ボタン](#フローティング作成ボタン)
    - [動的な表示制御](#動的な表示制御)
    - [画面遷移](#画面遷移-3)
    - [リンク無効化](#リンク無効化-2)

## 概要
日々の出来事を記録し、AI (Gemini API) がコメントをくれる機能を持つシンプルなWeb日記帳アプリケーションです。フロントエンドにはVue.js、バックエンドにはNode.js/Expressを使用して構築されています。ユーザー登録・ログイン機能、日記のCRUD操作、検索機能などを備えています。

## 公開URL
[https://diary.mikanbako.jp/](https://diary.mikanbako.jp/)

## 目的
ユーザー認証、CRUD操作、外部API連携（Gemini API）といった、Webアプリケーション開発における基本的な機能の実装経験を積むことを目的に制作しました。

## こだわったポイント
* **Gemini API連携**: ユーザーが記述した日記の内容に基づき、AI (Gemini API) がコメントを生成する機能を実装しました。ユーザーはAIの性別や関係性、コメントスタイルを設定でき、よりパーソナルな体験を得られます。
* **検索機能付き日記一覧**: ページネーション、キーワード検索（デバウンス処理付き）、日付による絞り込み（年月/年月日）、並び替え（昇順/降順）といった、実用的な一覧表示機能を実装しました。
* **状態管理とエラーハンドリング**: ログイン状態やAPI通信中のローディング状態をグローバルに管理し、UIに反映させています。また、axiosインターセプターで認証エラー時の自動ログアウトや、APIエラー発生時のモーダル表示など、堅牢性も意識しました。

## 今後の展望
* TypeScriptの導入による型安全性向上。
* 単体テスト・結合テストの導入による品質向上。

## 使用技術
**フロントエンド**
* Vue.js (v3)
* Vue Router
* Axios
* vue-datepicker（日付入力機能）
* simplebar-vue（スクロールバーカスタム）

**バックエンド**
* Node.js
* Express
* Prisma
* JWT（認証機能）
* bcryptjs（パスワードのハッシュ化）

**データベース**
* MySQL（本番環境）
* SQLite（開発環境）

**API**
* [Gemini API](https://ai.google.dev/api/generate-content?hl=ja#v1beta.models.generateContent)

**インフラ・その他**
* さくらVPS
* Apache（Webサーバー）
* pm2（Node.js Process起動用）

## 使用フォント
[Zen Maru Gothic](https://fonts.google.com/specimen/Zen+Maru+Gothic)

## デザインカンプ
[Figmaページ](https://www.figma.com/design/PM0PUujqI4QhWLHKSYZXlY/Diary-%E6%97%A5%E8%A8%98%E5%B8%B3%E3%82%A2%E3%83%97%E3%83%AA?node-id=0-1&t=YHTBa6kXNgUcqrsM-1)（閲覧のみ可能です）

## テーブル定義書
[テーブル定義書](https://docs.google.com/spreadsheets/d/1MvpjmFBf0TYdGGZldpBbFiIp7Ro0SINdkb1USx12AEs/edit?usp=sharing)（Googleスプレッドシートへのリンクです。）

## 機能テスト
[機能テスト表](https://docs.google.com/spreadsheets/d/1xSZY4r3QBzMDQ3fCB16fS5FFNCjj_AmNP8zL4zl5Ckg/edit?usp=sharing)（Googleスプレッドシートへのリンクです。）

## 各画面・機能説明
### ログイン画面
アプリの入り口となる画面です。登録済みのユーザー名とパスワードでログインします。

<img width="1920" height="919" alt="ログイン画面" src="https://github.com/user-attachments/assets/595b9909-46c6-4e02-9d89-9276cce6cd29" />

#### ユーザー認証

ユーザー名とパスワードを入力し、「ログイン」ボタンをクリックすると、バックエンド（Node.js/Express）で認証処理（bcryptjsによるパスワード照合）が行われます。

認証が成功すると、JWT（JSON Web Token）が発行され、Home画面(/home)へ遷移します。

#### お試しログイン機能

「お試しログイン」ボタンをクリックすると、事前に用意されたテスト用アカウント情報が自動で入力され、すぐにログインできます。ポートフォリオ経由でこのアプリを閲覧する方がすぐにアプリの機能を試せるように実装しました。

#### 入力値バリデーション

ユーザー名（10文字以内）やパスワード（4文字以上）の未入力チェックや文字数チェックを行います。各テキストボックスの下にエラーメッセージが表示されます。

サーバーからのエラー（「登録されていないユーザー名です。」や「パスワードが間違っています。」）も、ログインボタンの下に表示されます。

![ログイン画面：ユーザー名バリデーションGIF](https://github.com/user-attachments/assets/40b50610-382a-4657-81ab-ea5937e772b7)

![ログイン画面：パスワードバリデーションGIF](https://github.com/user-attachments/assets/2ac9de6b-3501-4b15-b5a8-07f563fa99cf)

#### 通知メッセージ表示

セッションの有効期限が切れた状態で認証が必要なページにアクセスした場合、自動でログイン画面にリダイレクトされ、「セッションが無効か期限切れです。再度ログインしてください。」というメッセージが表示されます。（axiosインターセプターによる制御）

<img width="1920" height="919" alt="ログイン画面：トークン切れメッセージ表示" src="https://github.com/user-attachments/assets/d8811cec-0245-4251-9608-1630e8b0580a" />

#### 画面遷移

「ユーザー登録」ボタンから、ユーザー登録画面(/register)へ遷移できます。

### ユーザー登録画面
新しいユーザーがアカウントを作成するための画面です。ログイン画面と共通のフォームコンポーネントを使用しています。

<img width="1920" height="919" alt="ユーザー登録画面" src="https://github.com/user-attachments/assets/211d99b5-7dda-4e25-ac32-9c11d8c9f11c" />

#### 新規ユーザー登録

ユーザー名とパスワードを入力し、「ユーザー登録」ボタンをクリックします。

バックエンド側でパスワードをbcryptjsを用いてハッシュ化してからデータベースに保存します。

登録が成功すると、そのままログイン時と同様にJWTが発行され、Home画面(/home)へ遷移します。

#### 入力値バリデーション

ログイン画面と共通のバリデーション（未入力チェック、文字数制限）に加え、サーバー側で「既に存在するユーザー名かどうか」もチェックします。

バリデーションエラーは各テキストボックスの下に、サーバーからのエラー（「こちらのユーザー名は既に使用されています。別のユーザー名を入力して下さい。」）はユーザー登録ボタンの下に表示されます。

![ユーザー登録画面：サーバーからのエラーメッセージ表示GIF](https://github.com/user-attachments/assets/bd0b482a-d57d-4bf1-bc1b-b36a8e8fc02b)

#### 画面遷移

既にアカウントを持っている方向けに、「ログイン」ボタンからログイン画面(/login)へ遷移することができます。

### Home画面
ログイン後に表示されるメイン画面です。ユーザー情報や最近の投稿を一覧できます。 PC表示ではユーザー情報が左側に固定され、SP表示では縦積みのレイアウトに切り替わります。

* PC表示

  <img width="1440" height="810" alt="Home画面PC表示" src="https://github.com/user-attachments/assets/0bc171df-8734-4630-b326-7e6d9e725f32" />

* SP表示

  <img width="375" height="667" alt="Home画面SP表示" src="https://github.com/user-attachments/assets/e0426999-e16a-4315-b7dc-6519f593db46" />

#### ユーザー情報カード
画面左側（SP表示では上部）に、ログイン中のユーザー名と、現在の総投稿数を表示します。

「作成」ボタンから日記作成画面(/diary/new)へ、「一覧」ボタンから日記一覧画面(/diaries)へアクセスできます。

#### お知らせ機能
その日にまだ日記を登録していない場合、「今日の日記がまだ登録されていません。」というメッセージを表示し、日記の作成を促します。

#### 最近の日記リスト
登録されている日記のうち、直近7件を「最近の日記」として新しい順に一覧表示します。

各日記アイテムには「Geminiコメント有り/無し」のラベルが表示され、AIによるコメントの有無が一目で分かるようになっています。

日記が1件も登録されていない場合は、「まだ日記が登録されていません。初めての日記を書いてみよう！」というメッセージを表示します。

日記の読み込み中はローディングスピナーを表示し、読み込み完了後にリストまたは未登録メッセージを表示することで、画面のチラつき（ガタつき）を抑えるよう制御しています。

![Home画面：日記取得ローディングGIF](https://github.com/user-attachments/assets/9e0522dc-6d64-47d3-a5f7-de06e7795a31)

#### 画面遷移
各日記アイテムをクリックすると、その日記の更新画面 (/diary/:id) へ遷移できます。

### 日記一覧画面
登録した日記を一覧で表示・管理する画面です。この画面には「キーワード検索」「日付絞り込み」「並び替え」「ページネーション」といった、一覧画面に求められる実用的な機能を実装しました。

<img width="1920" height="919" alt="日記一覧画面" src="https://github.com/user-attachments/assets/47892313-20c0-4523-a418-db4af2960f41" />

#### 検索設定
* キーワード検索

  日記の本文を対象に、部分一致で検索が可能です。入力から500ミリ秒後に自動で検索が実行されるデバウンス処理を実装し、サーバーへの過度な負荷を抑えています。

  ![日記一覧画面：キーワード検索GIF](https://github.com/user-attachments/assets/772458ab-e0bb-452e-805f-8ad2c322391f)

* 日付絞り込み

  「対象期間」のラジオボタンで、「すべて」/「年月」/「年月日」を切り替えられます。vue-datepickerを使用し、カレンダーから直感的に日付を選択できます。

  ![日記一覧画面：日付検索GIF](https://github.com/user-attachments/assets/3f7db483-4f9b-492f-a397-c809c30ea51c)

* 並び替え

  日記の登録日時を基準に、「新しい順（降順）」または「古い順（昇順）」で並び替えることができます。

* レスポンシブ対応

  PC幅 (1024px以上) では検索設定が常に表示されますが、SP幅 (1024px未満)ではアコーディオンメニューとして実装し、省スペースでも操作性を損なわないよう工夫しました。

  ![日記一覧画面：SP表示時の検索設定アコーディオンメニューGIF](https://github.com/user-attachments/assets/59fc4a1f-f41d-45fa-a488-e93896be09ed)

#### 日記一覧とページネーション
検索結果は1ページあたり最大10件ずつ表示されます。

総ページ数と現在表示ページに応じて、「< 1 ... 4 5 6 ... 10 >」のように、動的に省略記号（...）を差し込む自作のページネーション機能を実装しています。

![日記一覧画面：ページネーションGIF](https://github.com/user-attachments/assets/3c223459-6668-46f6-99db-8943ae7c747f)

検索結果が0件の場合は、「検索条件に該当する日記はありません。」というメッセージを表示します。

Home画面と同様に、日記の読み込み中はローディングスピナーを表示します。

#### 日記の操作（編集・削除）
* 編集

  各日記アイテムの「編集」ボタン（緑色）から、日記作成（更新モード）画面へ遷移できます。

* 削除

  「削除」ボタン（赤色）をクリックすると、確認モーダルを表示し、誤操作を防ぎます。

  削除が完了すると、結果をモーダルで通知した後、日記一覧を自動で再読み込みして最新の状態を反映します。

  ![日記一覧画面：日記削除GIF](https://github.com/user-attachments/assets/3100b254-2ca3-4275-9341-d71df9031904)

### 日記作成画面
日記の「新規作成」と「更新」の両方を担う画面です。URLのパスによってモードが切り替わります。（/diary/newで新規作成、/diary/:idで更新モード）

<img width="1920" height="1841" alt="日記作成画面：新規作成モード" src="https://github.com/user-attachments/assets/9593d46d-404e-4ed8-97b7-638fc8c27adf" />

#### 新規作成・更新モード共通の機能
* Gemini API 連携（コメント自動生成）

  このアプリの最大の特徴です。日記の内容を入力した後、「Geminiにコメントをもらう」ボタン をクリックすると、GoogleのGemini API(gemini-2.5-flash-preview-05-20)にリクエストが送信されます。

  「書き手の性別」/「Geminiの性別」/「関係性」/「コメントスタイル」を細かく設定でき、その設定に応じたパーソナライズされたコメントをAIが生成し、画面に表示します。この設定はローカルストレージに自動で保存されるため、次回以降も同じ設定が引き継がれ、毎回設定し直す必要はありません。

  ![日記作成画面：Gemini API 設定操作GIF](https://github.com/user-attachments/assets/18b758fa-da02-4076-af01-1e9df456271d)

  コメント取得中は、ボタンのローディング表示だけでなく、ヘッダー・フッターも含めた全リンクを無効化（クラス.is-disabledを付与）し、API通信中の意図しない画面遷移を防ぎます。

  ![日記作成画面：GeminiにコメントをもらうGIF](https://github.com/user-attachments/assets/96c012c3-c26d-40ba-b7ac-a33a8428a860)

* レスポンシブ対応

  PC幅 (1024px以上) ではGemini API設定が常に表示されますが、SP幅 (1024px未満)ではアコーディオンメニューとして実装し、省スペースでも操作性を損なわないよう工夫しました。

  ![日記作成画面：SP表示時のGemini API設定アコーディオンメニューGIF](https://github.com/user-attachments/assets/26c913e3-96e5-423e-b6e0-f2c4cc01e54a)

* 入力値バリデーション

  「日付」が有効な値かどうかと未入力チェック、「日記内容」の未入力チェックを実装。エラーがある場合はモーダルで通知し、不正な値でのAPIリクエストを防ぎます。

  ![日記作成画面：日記内容未入力エラーモーダル表示GIF](https://github.com/user-attachments/assets/f7ceca5a-ed21-4462-8113-6941ed5fca66)

#### 新規作成モード
* 日記の登録

  日付（vue-datepickerを使用）と日記内容を入力し、「日記登録」ボタンをクリックすると、日記が新規登録されます。

  登録成功後は、今登録した日記の更新画面(/diary/:id)へ自動的に遷移し、そのまま「更新モード」に切り替わります。

  ![日記作成画面：日記の登録GIF](https://github.com/user-attachments/assets/485e4291-7a72-43d0-936c-e471f7280628)

#### 更新モード
* 日記の表示

  画面マウント時に、該当する日記データと、前後の日記IDを取得し、フォームにセットします。

* 日記の更新

  内容を編集して「更新」ボタンをクリックすると、日記が更新されます。更新成功時はモーダルで通知され、画面遷移はせず、そのまま更新画面に留まります。

  ![日記作成画面：日記の更新GIF](https://github.com/user-attachments/assets/6f585e5a-3c47-4553-b0c2-2efeec0c73d6)

* 日記の削除

  「削除」ボタンを押すと、確認モーダルが表示されます。確認メッセージには対象の日記の日付が含まれており、誤操作を防ぐようになっています。

  「削除する」を選択すると、日記が削除され、削除完了モーダル表示後に日記一覧画面(/diaries)へ遷移します。

  ![日記作成画面：日記の削除GIF](https://github.com/user-attachments/assets/ecc2e9b1-d7ef-4dbd-bfad-9d89502f039d)

* 前後の日記へのナビゲーション

  画面下部に「前の日記」/「次の日記」ボタンが表示され、クリックすると前後の日記の更新画面へ移動できます。

  一番古い日記や一番新しい日記を表示している場合は、対応するボタンが自動的に無効になります。

  ![日記作成画面：前後の日記への遷移GIF](https://github.com/user-attachments/assets/a9c737d4-6420-4354-bd7c-2fdfd68028fa)

### 404 Not Found画面
app-front/src/router/index.js に定義されていないパス（例: /diary/abc や /abcdefg）にアクセスした場合に表示される画面です。Vue Routerのcatch-allルート（path: '/:pathMatch(.*)*'）によって、すべての一致しなかったURLがこの画面にリダイレクトされます。

<img width="1920" height="919" alt="404 Not Found画面" src="https://github.com/user-attachments/assets/f874fb68-1d7c-4451-a3d4-6437b82b4da5" />

* エラーページであることを示す画像、タイトル、メッセージを表示します。

* 「Home」ボタンが設置されており、クリックするとHome画面（/home）へ遷移できます。

* 未ログイン時にクリックした場合は、Home画面へのアクセスがルートガードに弾かれ、自動的にログイン画面へ遷移します。

### ヘッダー
すべてのページの上部に表示される共通コンポーネントです。スクロールしても画面上部に固定されるよう設定しています。

<img width="1920" height="100" alt="ヘッダー：ＰＣログイン時" src="https://github.com/user-attachments/assets/443eae40-c312-4903-bf0f-7ae873a883b0" />

#### レスポンシブデザイン

PC幅（1024px以上）では、ナビゲーションリンクやユーザー名が横並びで表示されます。

SP幅（1024px未満）では、ナビゲーションリンクは非表示となり、代わりに「ハンバーガーメニュー」ボタンが表示されます。

#### ハンバーガーボタン (SP時)

ハンバーガーボタンをクリックすると、画面全体にナビゲーションメニューが表示されます。

メニュー表示中は、背景コンテンツがスクロールしないよう document.body.style.overflow = 'hidden' で制御しています。

再度ハンバーガーボタン（×マークに変形している）ボタンをクリックすると、メニューが閉じます。

![ヘッダー：SP時のメニュー開閉](https://github.com/user-attachments/assets/39975af7-8f29-46de-a708-470306f226d8)

#### 動的なリンク切り替え

グローバルなログイン状態を監視し、表示するナビゲーションリンクを動的に切り替えています。

未ログイン時は「Home」、「ログイン」、「ユーザー登録」リンクが表示されます。

ログイン時は「Home」、「日記作成」、「日記一覧」、「ログアウト」リンクが表示されます。

#### ユーザー名表示

ログイン時、ヘッダーに「（ユーザー名）さん」が表示されます。

#### リンク無効化

日記作成画面でGemini API通信中は、フッターやフローティング作成ボタンと同様に、ヘッダー内のすべてのリンクにも is-disabled クラスが付与され、意図しない画面遷移を防止します。

### フッター
すべてのページの最下部に表示される共通コンポーネントです。

<img width="1440" height="395" alt="フッター：ＰＣログイン時" src="https://github.com/user-attachments/assets/eb038d12-0b74-46ca-a20d-c85b0e226e4e" />

#### 動的なリンク切り替え

ヘッダーと同様に、グローバルなログイン状態を監視し、表示するナビゲーションリンクを動的に切り替えています。

未ログイン時は、「Home」、「ログイン」、「ユーザー登録」リンクが表示されます。

ログイン時は、「Home」、「日記作成」、「日記一覧」、「ログアウト」リンクが表示されます。

#### 外部リンク

自身の「ポートフォリオサイト」、「GitHub」、「技術ブログ」への外部リンクを設置しています。

#### リンク無効化

ヘッダーと同様に、Gemini API通信中は、フッター内のすべてのリンクに is-disabled クラスが付与され、API通信中の意図しない画面遷移を防止します。

### フローティング作成ボタン
SP表示（1024px未満）の際に、画面の右下に常に表示される円形の作成ボタン（ペンのアイコン）です。 SP表示での「日記作成」へのアクセス性を高めるために実装しました。

<img width="375" height="667" alt="フローティング作成ボタン" src="https://github.com/user-attachments/assets/29d20277-4d56-4bee-986c-9b6b542033d2" />

#### 動的な表示制御

以下の3つの条件をすべて満たした場合にのみ、ボタンが表示されます。

* SP幅（1024px未満）である

* ログイン済みである

* 現在表示しているページが「日記作成画面（新規作成モード）」ではない

#### 画面遷移

ボタンをクリックすると、日記作成画面(/diary/new)へ遷移します。

![フローティング作成ボタン：ボタンクリックGIF](https://github.com/user-attachments/assets/1cf307d1-4be5-411e-9002-ccbc3508b589)

#### リンク無効化

ヘッダーやフッターと同じく、Gemini API通信中は、is-disabled クラスが付与され、クリックできなくなります。